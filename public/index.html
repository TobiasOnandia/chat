<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat online</title>
</head>
<script type="module" src="/socket.io/socket.io.js"></script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

    :root{
        --primary-color: #1b1b1b;
        --secondary-color: #f1f1f1;
        --foreground: #ccc ;
        --tertiary-color: #000000;
        --border-color: #333333;
    }
    *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    body {
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        font-family: 'Montserrat', sans-serif;
        background-color: var(--secondary-color);
        color: var(--primary-color);
        display: flex;
    }
    
    img, picture, video, canvas, svg {
        display: block;
        max-width: 100%;
    }
    
    input, button, textarea, select {
        font: inherit;
    }
    
    p, h1, h2, h3, h4, h5, h6 {
        overflow-wrap: break-word;
    }
    
    p {
        text-wrap: pretty;
    }
    h1, h2, h3, h4, h5, h6 {
        text-wrap: balance;
    }


    main{
        flex: 1;
    }

    #messages{
        list-style: none;
        overflow-y: scroll;
        height: 85%;
        & > li {
            padding: 0.5rem 1rem;
            background-color: var(--foreground);
            border-radius: 5px;
            width: max-content;
            margin: 0.5rem;
            color: var(--secondary-color);
        }

        & > li:nth-child(even){
            background-color: var(--tertiary-color);

        }

    }

    section{
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem;
    }

    form{
        display: flex;
        align-items: end;
        gap: 0.2rem;
        padding: 0.5rem;
    }

    input{
        flex: 1;
        border-radius: 5px;
        height: 2rem;
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        background-color: transparent;
    }

    button{
        border-radius: 5px;
        color: var(--secondary-color);
        background-color: var(--tertiary-color);
        cursor: pointer;
        padding:  0.2rem;
        outline: none;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: none;
        border: none;
    }

    aside{
        flex: 0.2;
        border-right: 1px solid var(--border-color);
        height: 100vh;

    }

    #users{
        border-right: 1px solid var(--secondary-color);


        & > li {
            padding: 1rem;
            cursor: pointer;
            &:hover{
                background-color: var(--tertiary-color);
                color: var(--secondary-color);
            }
        }
    }

    #root, #__next {
        isolation: isolate;
    }
</style>

<script type="module">
    let counter = 0
    const socket = io({
        auth: {
            serverOffset: 0
        },
        ackTimeout: 10000,
        retries:3
    })
    const $ = (selector) => document.querySelector(selector)

    const form = $('form')
    const input = $('input')
    const messages = $('#messages')
   
    form.addEventListener('submit', (e) => {
        e.preventDefault()
        if(input.value){

            const clientOffset = `${socket.id}-${counter++}`
            socket.emit('chat message', input.value, clientOffset)
            input.value = ''
        }
    })

    socket.on('chat message', (message, serverOffset) => {
        console.log("Mensaje recibido desde whatsapp",message)
        const messageElement = document.createElement('li')
        messageElement.textContent = message
        messages.appendChild(messageElement)
        window.scrollTo(0, document.body.scrollHeight)
        socket.auth.serverOffset = serverOffset
    })

</script>
<body>
    <aside>
        <section>
            <h3>
                Chats
            </h3>
            <button>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-plus"><path d="M0 0h24v24H0z" stroke="none"/><path d="M12 5V19M5 12H19"/></svg>
            </button>
        </section>        
        <ul id="users">
            <li>Usuario 1</li>
            <li>Usuario 2</li>
            <li>Usuario 3</li>
        </ul>
    </aside>
    <main>
        <section>
            <h2>+542954270707</h2>
        </section>
        <ul id="messages"></ul>
        <form action="">
            <input type="text" name="message" placeholder="Escribe tu mensaje">
            <button type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-send"><path d="M0 0h24v24H0z" stroke="none"/><path d="M10 14 21 3M21 3l-6.5 18a.55.55 0 0 1-1 0L10 14l-7-3.5a.55.55 0 0 1 0-1L21 3"/></svg>
            </button>
        </form>
    </main>
</body>
</html>